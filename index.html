<!DOCTYPE html>
<html lang="ko" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비파괴 철근 탐지기 설계 및 제작 프로젝트</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
        }
        .section-title {
            @apply text-3xl md:text-4xl font-bold text-gray-800 mb-4 text-center;
        }
        .section-subtitle {
            @apply text-lg text-gray-600 mb-12 text-center max-w-3xl mx-auto;
        }
        .card {
            @apply bg-white rounded-xl shadow-lg overflow-hidden transition-transform duration-300 hover:scale-105;
        }
        .modal-overlay {
            @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300;
        }
        .modal-content {
            @apply bg-white rounded-lg shadow-xl p-8 max-w-2xl w-full m-4 transform transition-transform duration-300 scale-95;
        }
        .spinner {
            border-top-color: #3498db;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-700">

    <!-- Navigation Bar -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 shadow-md">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#" class="text-xl font-bold text-gray-800">철근 탐지기 프로젝트</a>
            <div class="hidden md:flex space-x-6">
                <a href="#intro" class="text-gray-600 hover:text-blue-600">소개</a>
                <a href="#tech" class="text-gray-600 hover:text-blue-600">기술</a>
                <a href="#design" class="text-gray-600 hover:text-blue-600">설계</a>
                <a href="#results" class="text-gray-600 hover:text-blue-600">결과</a>
                <a href="#future" class="text-gray-600 hover:text-blue-600">미래</a>
                <a href="#ai-analysis" class="text-gray-600 hover:text-blue-600">AI 분석</a>
                <a href="#team" class="text-gray-600 hover:text-blue-600">팀원</a>
            </div>
            <div class="md:hidden">
                <button id="menu-btn" class="text-gray-800 focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white">
            <a href="#intro" class="block py-2 px-4 text-sm hover:bg-gray-200">소개</a>
            <a href="#tech" class="block py-2 px-4 text-sm hover:bg-gray-200">기술</a>
            <a href="#design" class="block py-2 px-4 text-sm hover:bg-gray-200">설계</a>
            <a href="#results" class="block py-2 px-4 text-sm hover:bg-gray-200">결과</a>
            <a href="#future" class="block py-2 px-4 text-sm hover:bg-gray-200">미래</a>
            <a href="#ai-analysis" class="block py-2 px-4 text-sm hover:bg-gray-200">AI 분석</a>
            <a href="#team" class="block py-2 px-4 text-sm hover:bg-gray-200">팀원</a>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <section class="relative h-[60vh] md:h-[80vh] flex items-center justify-center text-white">
            <div class="absolute inset-0 bg-black opacity-50"></div>
            <img src="https://placehold.co/1600x900/4a5568/ffffff?text=안전한+건축을+위한+혁신" alt="건설 현장 이미지" class="w-full h-full object-cover">
            <div class="relative z-10 text-center px-4">
                <h1 class="text-4xl md:text-6xl font-bold mb-4 leading-tight">콘크리트 속 철근 탐지기 설계 및 제작</h1>
                <p class="text-xl md:text-2xl font-light">전자공학 기술과 AI로 건설 현장의 안전을 혁신합니다.</p>
            </div>
        </section>

        <!-- Sections remain the same until 'Future Section' -->
        <section id="intro" class="py-20 px-6">
            <div class="container mx-auto">
                <h2 class="section-title">프로젝트 소개</h2>
                <p class="section-subtitle">최근 건설 현장의 붕괴 사고는 철근 부실 시공의 위험성을 보여줍니다. 우리는 이 문제를 해결하기 위해 저비용 고효율의 비파괴 철근 탐지기를 개발했습니다.</p>
                <div class="flex flex-col md:flex-row items-center gap-12">
                    <div class="md:w-1/2">
                        <img src="https://placehold.co/600x400/e53e3e/ffffff?text=건설+안전+문제" alt="붕괴된 건물 일러스트" class="rounded-lg shadow-2xl w-full">
                    </div>
                    <div class="md:w-1/2">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800">탐구 동기</h3>
                        <p class="mb-4">기존의 전문 탐지 장비는 고가이거나 운용이 복잡하여 현장 접근성이 떨어집니다. 철근 누락이나 불량 시공은 육안으로 확인이 불가능하여 심각한 안전 문제로 이어질 수 있습니다.</p>
                        <p class="mb-4">저희는 전자기 유도 현상을 이용해 누구나 쉽게 사용할 수 있는 저비용, 고효율 탐지 시스템을 개발하여 건설 현장의 안전성을 높이고자 했습니다.</p>
                        <p class="font-semibold text-blue-600">이 프로젝트를 통해 실용적인 기술 개발 경험을 쌓고, 전자공학과 건축공학의 융합적 사고를 기르고자 합니다.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="tech" class="py-20 px-6 bg-white">
            <div class="container mx-auto">
                <h2 class="section-title">핵심 기술 원리</h2>
                <p class="section-subtitle">패러데이의 전자기 유도 법칙을 기반으로, 구조물을 손상시키지 않고 내부의 철근을 정확하게 찾아냅니다.</p>
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div>
                        <h3 class="text-2xl font-bold mb-4 text-gray-800">전자기 유도와 비파괴 검사</h3>
                        <ul class="space-y-4">
                            <li class="flex items-start">
                                <span class="text-blue-500 mr-3 mt-1">✓</span>
                                <div><strong class="font-semibold text-gray-800">철근의 역할:</strong> 콘크리트의 약점인 인장 강도를 보완하여 구조물의 안전성을 높이는 핵심 자재입니다.</div>
                            </li>
                            <li class="flex items-start">
                                <span class="text-blue-500 mr-3 mt-1">✓</span>
                                <div><strong class="font-semibold text-gray-800">비파괴 검사 (NDT):</strong> 구조물을 손상시키지 않고 내부 결함을 찾는 검사 방식으로, 저희는 전자기 유도법을 사용했습니다.</div>
                            </li>
                            <li class="flex items-start">
                                <span class="text-blue-500 mr-3 mt-1">✓</span>
                                <div><strong class="font-semibold text-gray-800">전자기 유도 원리:</strong> 탐지 코일에서 발생시킨 1차 자기장이 철근에 와전류를 만들고, 이 와전류가 생성하는 2차 자기장의 미세한 변화를 감지하여 철근의 존재를 확인합니다.</div>
                            </li>
                        </ul>
                    </div>
                    <div>
                        <img src="https://placehold.co/600x400/38b2ac/ffffff?text=전자기+유도+원리+도식화" alt="전자기 유도 원리" class="rounded-lg shadow-2xl w-full">
                    </div>
                </div>
            </div>
        </section>

        <section id="design" class="py-20 px-6">
            <div class="container mx-auto">
                <h2 class="section-title">시스템 설계</h2>
                <p class="section-subtitle">하드웨어와 소프트웨어의 유기적인 결합을 통해 정확하고 안정적인 탐지 성능을 구현했습니다.</p>
                <div class="grid md:grid-cols-2 gap-16">
                    <div class="card p-8">
                        <h3 class="text-2xl font-bold mb-4 text-center">하드웨어 구성</h3>
                        <img src="https://placehold.co/500x300/4299e1/ffffff?text=회로도" alt="회로도" class="rounded-md mb-6 w-full object-cover">
                        <ul class="space-y-2 text-sm">
                            <li><strong>탐지 코일:</strong> LC 공명 회로를 이용해 자기장 생성</li>
                            <li><strong>센서 모듈:</strong> Hall Sensor (A1324)로 자기장 변화 감지</li>
                            <li><strong>제어부:</strong> Arduino Uno가 신호 처리 및 전체 시스템 제어</li>
                            <li><strong>출력부:</strong> LED, 피에조 부저, LCD로 시청각 피드백 제공</li>
                            <li><strong>전원부:</strong> 9V 배터리로 휴대성 확보 (약 500g)</li>
                        </ul>
                    </div>
                    <div class="card p-8">
                        <h3 class="text-2xl font-bold mb-4 text-center">소프트웨어 알고리즘</h3>
                        <img src="https://placehold.co/500x300/f56565/ffffff?text=소프트웨어+알고리즘" alt="소프트웨어 알고리즘" class="rounded-md mb-6 w-full object-cover">
                        <ul class="space-y-2 text-sm">
                            <li><strong>실시간 분석:</strong> 센서 데이터를 실시간으로 분석하여 철근 위치 판단</li>
                            <li><strong>신호 안정화:</strong> 이동 평균 및 칼만 필터 적용으로 노이즈 제거</li>
                            <li><strong>정확도 향상:</strong> 기계학습을 통한 패턴 분석으로 정확도 개선 가능성</li>
                            <li><strong>사용자 인터페이스:</strong> 탐지 강도에 따라 LED 밝기와 부저 주파수 변화</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="results" class="py-20 px-6 bg-white">
            <div class="container mx-auto">
                <h2 class="section-title">실험 및 검증 결과</h2>
                <p class="section-subtitle">자체 제작한 콘크리트 블록을 이용한 엄격한 테스트를 통해 탐지기의 성능을 객관적으로 검증했습니다.</p>
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-4 border-b-2 border-gray-200 font-bold text-gray-700">매립 깊이</th>
                                    <th class="p-4 border-b-2 border-gray-200 font-bold text-gray-700">탐지 성공률</th>
                                    <th class="p-4 border-b-2 border-gray-200 font-bold text-gray-700">반응 시간</th>
                                    <th class="p-4 border-b-2 border-gray-200 font-bold text-gray-700">위치 정확도</th>
                                    <th class="p-4 border-b-2 border-gray-200 font-bold text-gray-700">비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="p-4 border-b border-gray-200">1-3cm</td>
                                    <td class="p-4 border-b border-gray-200 font-semibold text-green-600">100%</td>
                                    <td class="p-4 border-b border-gray-200">즉시</td>
                                    <td class="p-4 border-b border-gray-200">±1cm</td>
                                    <td class="p-4 border-b border-gray-200">모든 철근에서 양호</td>
                                </tr>
                                <tr>
                                    <td class="p-4 border-b border-gray-200">3-5cm</td>
                                    <td class="p-4 border-b border-gray-200 font-semibold text-green-600">95%</td>
                                    <td class="p-4 border-b border-gray-200">1-2초</td>
                                    <td class="p-4 border-b border-gray-200">±1.5cm</td>
                                    <td class="p-4 border-b border-gray-200">얇은 철근에서 일부 누락</td>
                                </tr>
                                <tr>
                                    <td class="p-4 border-b border-gray-200">5-8cm</td>
                                    <td class="p-4 border-b border-gray-200 font-semibold text-yellow-600">80%</td>
                                    <td class="p-4 border-b border-gray-200">2-3초</td>
                                    <td class="p-4 border-b border-gray-200">±2cm</td>
                                    <td class="p-4 border-b border-gray-200">굵은 철근에서만 양호</td>
                                </tr>
                                <tr>
                                    <td class="p-4 border-b border-gray-200">8-10cm</td>
                                    <td class="p-4 border-b border-gray-200 font-semibold text-orange-600">60%</td>
                                    <td class="p-4 border-b border-gray-200">3-5초</td>
                                    <td class="p-4 border-b border-gray-200">±3cm</td>
                                    <td class="p-4 border-b border-gray-200">가장 굵은 철근에서만 탐지</td>
                                </tr>
                                <tr class="bg-gray-50">
                                    <td class="p-4 border-b border-gray-200">10cm 이상</td>
                                    <td class="p-4 border-b border-gray-200 font-semibold text-red-600">30%</td>
                                    <td class="p-4 border-b border-gray-200">5초 이상</td>
                                    <td class="p-4 border-b border-gray-200">±5cm</td>
                                    <td class="p-4 border-b border-gray-200">실용성 저하</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="mt-12 text-center">
                    <h3 class="text-xl font-bold text-gray-800">성능 검증 결론</h3>
                    <p class="mt-2 max-w-2xl mx-auto">전체적으로 8cm 이하 깊이에서 80% 이상의 탐지 성공률을 보여 일반 건축물 검사에 적합하며, 특히 5cm 이하 깊이에서는 95% 이상의 높은 정확도로 대부분의 현장에서 충분한 성능을 발휘함을 확인했습니다.</p>
                </div>
            </div>
        </section>
        
        <section id="gallery" class="py-20 px-6">
            <div class="container mx-auto">
                <h2 class="section-title">프로젝트 활동 모습</h2>
                <p class="section-subtitle">아이디어 구상부터 회로 제작, 코딩, 실험까지 팀원 모두가 열정적으로 참여했습니다.</p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="card"><img src="https://placehold.co/400x300/718096/ffffff?text=회로+구성" alt="팀 활동 1" class="w-full h-full object-cover"></div>
                    <div class="card"><img src="https://placehold.co/400x300/718096/ffffff?text=코딩+작업" alt="팀 활동 2" class="w-full h-full object-cover"></div>
                    <div class="card"><img src="https://placehold.co/400x300/718096/ffffff?text=콘크리트+테스트" alt="팀 활동 3" class="w-full h-full object-cover"></div>
                    <div class="card"><img src="https://placehold.co/400x300/718096/ffffff?text=성능+검증" alt="팀 활동 4" class="w-full h-full object-cover"></div>
                </div>
            </div>
        </section>

        <section id="future" class="py-20 px-6 bg-white">
            <div class="container mx-auto">
                <h2 class="section-title">결론 및 향후 발전 계획</h2>
                <p class="section-subtitle">이번 프로젝트의 성공과 한계를 바탕으로, 저희는 더 나은 기술을 향한 도전을 계속할 것입니다.</p>
                <div class="flex flex-col md:flex-row gap-12 items-center">
                    <div class="md:w-1/2">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800">한계점 및 개선 방향</h3>
                        <p class="mb-6">현재 탐지기는 8cm 이상 깊이에서 정확도가 감소하고 외부 전자기 간섭에 약한 한계가 있습니다. 이를 극복하기 위해 신호 증폭 회로를 개선하고 디지털 필터를 강화하여 잡음을 효과적으로 제거할 계획입니다.</p>
                        
                        <h3 class="text-2xl font-bold mb-4 text-gray-800">장기 발전 계획</h3>
                        <ul class="space-y-3">
                            <li class="flex items-start">
                                <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-3 flex-shrink-0">1</span>
                                <span><strong class="font-semibold">다중 센서 시스템:</strong> 센서를 격자 배치하여 2D/3D 철근 배치 지도를 구현합니다.</span>
                            </li>
                            <li class="flex items-start">
                                <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-3 flex-shrink-0">2</span>
                                <span><strong class="font-semibold">AI 분석 도입:</strong> 머신러닝으로 철근의 크기, 종류, 부식 상태까지 판별합니다.</span>
                            </li>
                            <li class="flex items-start">
                                <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-3 flex-shrink-0">3</span>
                                <span><strong class="font-semibold">플랫폼 통합:</strong> 드론 및 클라우드 시스템과 연동하여 대규모 현장의 자동화된 품질 검사 시스템을 구축합니다.</span>
                            </li>
                        </ul>
                    </div>
                    <div class="md:w-1/2">
                        <img src="https://placehold.co/600x400/667eea/ffffff?text=미래+기술+비전" alt="미래 개선 방향" class="rounded-lg shadow-2xl w-full">
                    </div>
                </div>
            </div>
        </section>

        <!-- AI Analysis Section -->
        <section id="ai-analysis" class="py-20 px-6">
            <div class="container mx-auto">
                <h2 class="section-title">✨ AI 기반 데이터 분석</h2>
                <p class="section-subtitle">Gemini API를 활용하여 탐지 데이터를 분석하고, 건설 안전에 대한 궁금증을 해결해 보세요.</p>
                <div class="grid md:grid-cols-2 gap-16">
                    <!-- AI Report Generator -->
                    <div class="card p-8">
                        <h3 class="text-2xl font-bold mb-4 text-center">AI 분석 보고서 생성</h3>
                        <p class="text-center text-sm text-gray-600 mb-4">측정한 데이터를 입력하면 AI가 분석하여 보고서를 만들어 드립니다.</p>
                        <textarea id="report-data" class="w-full h-40 border border-gray-300 rounded-md p-3 text-sm" placeholder="예시)&#10;위치: A-1, 깊이: 3cm, 신호 강도: 950&#10;위치: A-2, 깊이: 3.2cm, 신호 강도: 930&#10;위치: B-1, 깊이: 7cm, 신호 강도: 450"></textarea>
                        <button id="generate-report-btn" class="mt-4 w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center">
                            <span class="mr-2">✨ AI 분석 보고서 생성</span>
                            <div id="report-loader" class="hidden spinner w-5 h-5 border-2 border-white rounded-full"></div>
                        </button>
                    </div>
                    <!-- AI Q&A Chatbot -->
                    <div class="card p-8 flex flex-col">
                        <h3 class="text-2xl font-bold mb-4 text-center">AI 전문가에게 질문하기</h3>
                        <div id="chat-box" class="flex-grow h-64 border border-gray-300 rounded-md p-3 overflow-y-auto bg-gray-50 mb-4 text-sm">
                            <div class="text-gray-500">안녕하세요! 건설 안전 및 재료 전문가 AI입니다. 무엇이든 물어보세요.</div>
                        </div>
                        <div class="flex gap-2">
                            <input type="text" id="chat-input" class="flex-grow border border-gray-300 rounded-md p-3 text-sm" placeholder="예: 철근 부식의 원인은 무엇인가요?">
                            <button id="ask-expert-btn" class="bg-green-600 text-white font-bold py-3 px-5 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center">
                                <span>전송</span>
                                <div id="chat-loader" class="hidden spinner w-5 h-5 border-2 border-white rounded-full ml-2"></div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Team Section -->
        <section id="team" class="py-20 px-6 bg-white">
            <div class="container mx-auto">
                <h2 class="section-title">프로젝트 팀원</h2>
                <p class="section-subtitle">서로 다른 강점을 가진 팀원들이 협력하여 시너지를 만들었습니다.</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8">
                    <div class="text-center">
                        <img src="https://placehold.co/150x150/cbd5e0/2d3748?text=김성우" alt="김성우" class="w-32 h-32 rounded-full mx-auto mb-4 shadow-lg border-4 border-white">
                        <h4 class="text-xl font-bold">김성우</h4>
                        <p class="text-gray-500">프로젝트 총괄 및 기획</p>
                    </div>
                    <div class="text-center">
                        <img src="https://placehold.co/150x150/cbd5e0/2d3748?text=김건우" alt="김건우" class="w-32 h-32 rounded-full mx-auto mb-4 shadow-lg border-4 border-white">
                        <h4 class="text-xl font-bold">김건우</h4>
                        <p class="text-gray-500">이론 연구 및 시스템 설계</p>
                    </div>
                    <div class="text-center">
                        <img src="https://placehold.co/150x150/cbd5e0/2d3748?text=최윤석" alt="최윤석" class="w-32 h-32 rounded-full mx-auto mb-4 shadow-lg border-4 border-white">
                        <h4 class="text-xl font-bold">최윤석</h4>
                        <p class="text-gray-500">하드웨어 제작 및 실험</p>
                    </div>
                    <div class="text-center">
                        <img src="https://placehold.co/150x150/cbd5e0/2d3748?text=박찬영" alt="박찬영" class="w-32 h-32 rounded-full mx-auto mb-4 shadow-lg border-4 border-white">
                        <h4 class="text-xl font-bold">박찬영</h4>
                        <p class="text-gray-500">소프트웨어 개발 및 데이터 분석</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12 px-6">
        <div class="container mx-auto text-center">
            <h3 class="text-2xl font-bold mb-4">질의응답</h3>
            <p class="mb-6">프로젝트에 대해 궁금한 점이 있으시면 언제든지 문의해주세요.</p>
            <p class="text-sm text-gray-400">&copy; 2025 비파괴 철근 탐지기 프로젝트 팀. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Report Modal -->
    <div id="report-modal" class="modal-overlay hidden opacity-0">
        <div class="modal-content scale-95">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-gray-800">AI 분석 보고서</h3>
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div id="report-output" class="text-gray-700 whitespace-pre-wrap max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <script>
        // Mobile menu toggle
        const menuBtn = document.getElementById('menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        menuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Gemini API Interaction
        const reportDataInput = document.getElementById('report-data');
        const generateReportBtn = document.getElementById('generate-report-btn');
        const reportLoader = document.getElementById('report-loader');
        const reportModal = document.getElementById('report-modal');
        const reportOutput = document.getElementById('report-output');
        const closeModalBtn = document.getElementById('close-modal-btn');

        const chatBox = document.getElementById('chat-box');
        const chatInput = document.getElementById('chat-input');
        const askExpertBtn = document.getElementById('ask-expert-btn');
        const chatLoader = document.getElementById('chat-loader');

        const apiKey = ""; // API 키가 필요 없는 모델 사용

        // AI Report Generation
        generateReportBtn.addEventListener('click', async () => {
            const data = reportDataInput.value;
            if (!data.trim()) {
                alert('분석할 데이터를 입력해주세요.');
                return;
            }

            reportLoader.classList.remove('hidden');
            generateReportBtn.disabled = true;

            const prompt = `
                당신은 건설 현장의 구조 안전 진단 전문가입니다. 아래의 철근 탐지기 측정 데이터를 바탕으로 전문적인 분석 보고서를 작성해주세요.
                보고서에는 다음 내용이 포함되어야 합니다:
                1.  데이터 요약
                2.  주요 발견 사항 (예: 철근 깊이가 너무 얕은 구간, 신호 강도가 비정상적으로 낮은 구간 등)
                3.  잠재적 위험 요소 및 원인 분석
                4.  권장 조치 사항 (예: 해당 구간 정밀 재검사, 설계 도면과 비교 확인 등)
                5.  종합적인 전문가 소견

                [측정 데이터]
                ${data}
            `;

            try {
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    reportOutput.textContent = text;
                    reportModal.classList.remove('hidden');
                    setTimeout(() => {
                        reportModal.classList.remove('opacity-0');
                        reportModal.querySelector('.modal-content').classList.remove('scale-95');
                    }, 10);
                } else {
                    reportOutput.textContent = "오류: AI로부터 유효한 응답을 받지 못했습니다. 입력 데이터를 확인하거나 다시 시도해주세요.";
                }

            } catch (error) {
                console.error('Error:', error);
                reportOutput.textContent = `오류가 발생했습니다: ${error.message}`;
            } finally {
                reportLoader.classList.add('hidden');
                generateReportBtn.disabled = false;
            }
        });

        closeModalBtn.addEventListener('click', () => {
             reportModal.classList.add('opacity-0');
             reportModal.querySelector('.modal-content').classList.add('scale-95');
             setTimeout(() => {
                reportModal.classList.add('hidden');
             }, 300);
        });

        // AI Q&A Chatbot
        const askExpert = async () => {
            const question = chatInput.value;
            if (!question.trim()) return;

            appendMessage(question, 'user');
            chatInput.value = '';
            chatLoader.classList.remove('hidden');
            askExpertBtn.disabled = true;

            const prompt = `
                당신은 건설 안전, 재료 공학, 비파괴 검사 분야의 친절하고 지식이 풍부한 전문가입니다. 
                사용자의 다음 질문에 대해 전문가의 입장에서 명확하고 이해하기 쉽게 설명해주세요.
                질문: ${question}
            `;
            
            try {
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    appendMessage(text, 'ai');
                } else {
                    appendMessage("죄송합니다, 답변을 생성하는 데 문제가 발생했습니다.", 'ai');
                }
            } catch (error) {
                console.error('Error:', error);
                appendMessage(`오류가 발생했습니다: ${error.message}`, 'ai');
            } finally {
                chatLoader.classList.add('hidden');
                askExpertBtn.disabled = false;
            }
        };

        askExpertBtn.addEventListener('click', askExpert);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                askExpert();
            }
        });

        function appendMessage(text, sender) {
            const messageDiv = document.createElement('div');
            const bubbleDiv = document.createElement('div');
            
            bubbleDiv.textContent = text;
            bubbleDiv.classList.add('p-3', 'rounded-lg', 'max-w-xs', 'md:max-w-md', 'break-words');

            if (sender === 'user') {
                messageDiv.classList.add('flex', 'justify-end', 'mb-2');
                bubbleDiv.classList.add('bg-blue-500', 'text-white');
            } else {
                messageDiv.classList.add('flex', 'justify-start', 'mb-2');
                bubbleDiv.classList.add('bg-gray-200', 'text-gray-800');
            }
            
            messageDiv.appendChild(bubbleDiv);
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

    </script>

</body>
</html>
